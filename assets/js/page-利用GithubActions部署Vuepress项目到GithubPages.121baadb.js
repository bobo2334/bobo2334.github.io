(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{557:function(t,s,a){t.exports=a.p+"assets/img/image-20210824225724791.665c79e6.png"},558:function(t,s,a){t.exports=a.p+"assets/img/image-20210824230246146.08e1e955.png"},730:function(t,s,a){"use strict";a.r(s);var e=a(1),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"利用-github-actions-部署-vuepress-项目到-github-pages"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#利用-github-actions-部署-vuepress-项目到-github-pages"}},[t._v("#")]),t._v(" 利用 Github Actions 部署 Vuepress 项目到 Github Pages")]),t._v(" "),e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),e("p",[t._v("Vuepress"),e("sup",{staticClass:"footnote-ref"},[e("a",{attrs:{href:"#footnote1"}},[t._v("[1]")]),e("a",{staticClass:"footnote-anchor",attrs:{id:"footnote-ref1"}})]),t._v(" 是一个基于 Vue 的静态网站生成器；Github Pages"),e("sup",{staticClass:"footnote-ref"},[e("a",{attrs:{href:"#footnote2"}},[t._v("[2]")]),e("a",{staticClass:"footnote-anchor",attrs:{id:"footnote-ref2"}})]),t._v(" 是 Github 提供的免费的静态网站托管服务；Github Actions"),e("sup",{staticClass:"footnote-ref"},[e("a",{attrs:{href:"#footnote3"}},[t._v("[3]")]),e("a",{staticClass:"footnote-anchor",attrs:{id:"footnote-ref3"}})]),t._v(" 是 Github 仓库中集成的 CI/CD"),e("sup",{staticClass:"footnote-ref"},[e("a",{attrs:{href:"#footnote4"}},[t._v("[4]")]),e("a",{staticClass:"footnote-anchor",attrs:{id:"footnote-ref4"}})]),t._v(" 服务。")]),t._v(" "),e("p",[t._v("Vuepress 是一个 Node.js 项目，它可以根据配置将 Markdown 文件转为 HTML 文件。你可以将输出的静态文件托管在 Github Pages 中，这样你就得到了一个可以访问的域名来展示这些静态的 HTML 文件。")]),t._v(" "),e("p",[t._v("传统的做法是在本地安装好 Noed.js 环境，自己手动构建项目之后将构建产物上传到 Github 仓库，从而触发 Github Pages 的构建。现在可以利用 Github Actions 来代替手工劳动，Github Actions 可以自动被触发，它运行在 Github 提供的虚拟环境中，可以执行一系列任务从而代替重复枯燥的手动构建和部署的步骤。")]),t._v(" "),e("h2",{attrs:{id:"创建-github-仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-github-仓库"}},[t._v("#")]),t._v(" 创建 Github 仓库")]),t._v(" "),e("p",[t._v("在创建的 Github 仓库时要注意仓库名称，假如你的用户名是 foo。")]),t._v(" "),e("p",[t._v("如果你创建了一个名为 "),e("code",[t._v("foo.github.io")]),t._v("  的仓库，你将可以通过 "),e("code",[t._v("https://foo.github.io")]),t._v("  来访问此仓库的 Github Pages 内容；")]),t._v(" "),e("p",[t._v("如果你创建其他名称的仓库如 "),e("code",[t._v("bar")]),t._v(" ，你可以通过 "),e("code",[t._v("https://foo.github.io/bar/")]),t._v("  来访问此仓库的 Github Pages 内容。")]),t._v(" "),e("p",[t._v("你可以根据你期望的访问方式来选择仓库名称。")]),t._v(" "),e("h2",{attrs:{id:"配置-github-actions"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-github-actions"}},[t._v("#")]),t._v(" 配置 Github Actions")]),t._v(" "),e("p",[t._v("Github Actions 的配置文件应该放在项目根目录下的 "),e("code",[t._v(".github/workflows/")]),t._v("  文件夹中，你可以在一个项目中配置多个 Actions。配置文件是 YAML 格式，文件名形如 "),e("code",[t._v("*.yml")]),t._v(" 。")]),t._v(" "),e("p",[t._v("每一个 Action 中可以包括多个 job，每个 job 可以包括多个 step。在 step 中你可以直接运行命令，或者引用其他人编写好的 Action 脚本。在本文的配置文件中，我们引用了 github-pages-deploy-action"),e("sup",{staticClass:"footnote-ref"},[e("a",{attrs:{href:"#footnote5"}},[t._v("[5]")]),e("a",{staticClass:"footnote-anchor",attrs:{id:"footnote-ref5"}})]),t._v(" 来完成 Github Pages 部署，而不用关系其实现细节。")]),t._v(" "),e("p",[t._v("完成本文目标的 Github Actions 配置文件内容如下。")]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github actions build and deploy gh-pages"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("push")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build-and-deploy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Checkout\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v2.3.1\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persist-credentials")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install and build\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n          npm install\n          npm run build")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" JamesIves/github"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("deploy"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@4.1.4\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("BRANCH")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gh"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("FOLDER")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docs/.vuepress/dist\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br"),e("span",{staticClass:"line-number"},[t._v("22")]),e("br")])]),e("p",[t._v("其中的一些关键配置解释如下。")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("on.push.branches")]),t._v(" ，在推送到 "),e("code",[t._v("master")]),t._v("  分支时触发此 Action；")]),t._v(" "),e("li",[e("code",[t._v("jobs.build-and-deploy")]),t._v(" ，在一个 Action 中可以有多个 job，这是其中的一个，名称是自己取的；每个任务可以有多个 step；")]),t._v(" "),e("li",[e("code",[t._v("jobs.build-and-deploy.steps[0]")]),t._v(" ，用 "),e("code",[t._v("actions/checkout")]),t._v("  检出仓库内容；")]),t._v(" "),e("li",[e("code",[t._v("jobs.build-and-deploy.steps[1]")]),t._v(" ，执行 "),e("code",[t._v("npm")]),t._v("  命令安装开发环境；")]),t._v(" "),e("li",[e("code",[t._v("jobs.build-and-deploy.steps[2]")]),t._v(" ，用 "),e("code",[t._v("JamesIves/github-pages-deploy-action")]),t._v("  部署 "),e("code",[t._v("docs/.vuepress/dist")]),t._v("  文件夹中的内容到 "),e("code",[t._v("gh-pages")]),t._v("  分支中。")])]),t._v(" "),e("p",[t._v("在编写好配置文件后可以提交并推送文件至 master 分支，这会自动触发 Action 的执行，并且你可以在 Actions 栏目中查看执行日志。")]),t._v(" "),e("p",[e("img",{attrs:{src:a(557),alt:"image-20210824225724791"}})]),t._v(" "),e("h2",{attrs:{id:"配置-github-pages"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-github-pages"}},[t._v("#")]),t._v(" 配置 Github Pages")]),t._v(" "),e("p",[t._v("我们的构建产物放在 gh-pages 分支，我们需要告诉 Github Pages 源文件位置。")]),t._v(" "),e("p",[t._v("在 Github 仓库的 Settings 栏目中，从左侧的设置导航栏找到 Pages 设置。在这里你可以设置 gh-pages 为数据源。")]),t._v(" "),e("p",[e("img",{attrs:{src:a(558),alt:"image-20210824230246146"}})]),t._v(" "),e("p",[t._v("如果没出错的话，在配置完成之后你就可以通过 Github Pages 给你提供的域名来访问你的静态网站了。")]),t._v(" "),e("hr",{staticClass:"footnotes-sep"}),t._v(" "),e("section",{staticClass:"footnotes"},[e("ol",{staticClass:"footnotes-list"},[e("li",{staticClass:"footnote-item",attrs:{id:"footnote1"}},[e("p",[e("a",{attrs:{href:"https://v2.vuepress.vuejs.org/zh/",target:"_blank",rel:"noopener noreferrer"}},[t._v("首页 | VuePress"),e("OutboundLink")],1),t._v(" "),e("a",{staticClass:"footnote-backref",attrs:{href:"#footnote-ref1"}},[t._v("↩︎")])])]),t._v(" "),e("li",{staticClass:"footnote-item",attrs:{id:"footnote2"}},[e("p",[e("a",{attrs:{href:"https://pages.github.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Pages | Websites for you and your projects, hosted directly from your GitHub repository. Just edit, push, and your changes are live."),e("OutboundLink")],1),t._v(" "),e("a",{staticClass:"footnote-backref",attrs:{href:"#footnote-ref2"}},[t._v("↩︎")])])]),t._v(" "),e("li",{staticClass:"footnote-item",attrs:{id:"footnote3"}},[e("p",[e("a",{attrs:{href:"https://docs.github.com/en/actions/learn-github-actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn GitHub Actions - GitHub Docs"),e("OutboundLink")],1),t._v(" "),e("a",{staticClass:"footnote-backref",attrs:{href:"#footnote-ref3"}},[t._v("↩︎")])])]),t._v(" "),e("li",{staticClass:"footnote-item",attrs:{id:"footnote4"}},[e("p",[e("a",{attrs:{href:"https://www.redhat.com/zh/topics/devops/what-is-ci-cd",target:"_blank",rel:"noopener noreferrer"}},[t._v("什么是 CI/CD？一文带你理解 CI 持续集成和 CD 持续交付 / 部署 - 红帽"),e("OutboundLink")],1),t._v(" "),e("a",{staticClass:"footnote-backref",attrs:{href:"#footnote-ref4"}},[t._v("↩︎")])])]),t._v(" "),e("li",{staticClass:"footnote-item",attrs:{id:"footnote5"}},[e("p",[e("a",{attrs:{href:"https://github.com/JamesIves/github-pages-deploy-action",target:"_blank",rel:"noopener noreferrer"}},[t._v("JamesIves/github-pages-deploy-action: Automatically deploy your project to GitHub Pages using GitHub Actions. This action can be configured to push your production-ready code into any branch you'd like."),e("OutboundLink")],1),t._v(" "),e("a",{staticClass:"footnote-backref",attrs:{href:"#footnote-ref5"}},[t._v("↩︎")])])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);