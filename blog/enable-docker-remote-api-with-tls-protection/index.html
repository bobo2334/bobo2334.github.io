<!doctype html>
<html lang="zh-cn" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="我的学习笔记 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="我的学习笔记 Atom Feed">





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous">
<link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="/favicon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><title data-rh="true">开启 Docker Remote API 并启用 TLS | 我的学习笔记</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://iuok.me/blog/enable-docker-remote-api-with-tls-protection"><meta data-rh="true" name="docusaurus_locale" content="zh-cn"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-cn"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="msapplication-TileColor" contnet="#da532c"><meta data-rh="true" name="theme-color" contnet="#25c2a0"><meta data-rh="true" property="og:title" content="开启 Docker Remote API 并启用 TLS | 我的学习笔记"><meta data-rh="true" name="description" content="前言"><meta data-rh="true" property="og:description" content="前言"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-09-09T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="docker"><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://iuok.me/blog/enable-docker-remote-api-with-tls-protection"><link data-rh="true" rel="alternate" href="https://iuok.me/blog/enable-docker-remote-api-with-tls-protection" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://iuok.me/blog/enable-docker-remote-api-with-tls-protection" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.0cd320e1.css">
<link rel="preload" href="/assets/js/runtime~main.dce60640.js" as="script">
<link rel="preload" href="/assets/js/main.3e5db5dd.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/android-chrome-512x512.png" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/android-chrome-512x512.png" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">我的学习笔记</b></a><a class="navbar__item navbar__link" href="/docs/bookmarks/interesting-projects">笔记</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">文章</a><a class="navbar__item navbar__link" href="/blog/archive">文章归档</a><a class="navbar__item navbar__link" href="/blog/tags">文章标签</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/bobo2334/bobo2334.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">最新文章</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/gpg">使用 GPG 签名和加密</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tailscale">Tailscale 异地组网</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/google-no-counrty-redirect">使用 Google 搜索时指定 No Counrty Redirect</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/keeping-ssh-connections-alive">SSH 连接保活</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/openwrt-post-installation">OpenWrt 安装后配置</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">开启 Docker Remote API 并启用 TLS</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-09-09T00:00:00.000Z" itemprop="datePublished">2021年9月9日</time></div></header><div id="post-content" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="标题的直接链接">​</a></h2><p>Portainer<sup id="fnref-1-b62d91"><a href="#fn-1-b62d91" class="footnote-ref">1</a></sup> 是一款 Docker 可视化管理面板，它不仅可以管理本地的 Docker 实例，还可以通过 Docker Remote API 访问管理远程 Docker 资源。Docker Remote API 就是通过 HTTP 协议暴露 Docker 资源，启用 TLS 可以实现远程访问鉴权。</p><p>Docker 的官方文档提供了详细的开启 Docker Remote API 和开启 TLS 的教程 <sup id="fnref-2-b62d91"><a href="#fn-2-b62d91" class="footnote-ref">2</a></sup>。但是在签发证书的过程中涉及到的命令比较多，且繁琐，我就从网络上寻找到了别人写好的签发证书的脚本 <sup id="fnref-3-b62d91"><a href="#fn-3-b62d91" class="footnote-ref">3</a></sup>，可以很方便地替代纯手工操作。</p><p>本文中的操作都在 CentOS 7 中完成。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="签发证书">签发证书<a class="hash-link" href="#签发证书" title="标题的直接链接">​</a></h2><p>将脚本命名为<code>auto-tls-certs.sh</code>。其中需要配置的内容有：</p><ol><li><code>CODE</code>，作为文件名的后缀，用于区分文件；</li><li><code>IP</code>，机器的公网 IP 地址；</li><li><code>PASSWORD</code>，证书密码。</li></ol><p>脚本内容如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># -------------------------------------------------------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 自动创建 Docker TLS 证书</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># -------------------------------------------------------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 以下是配置信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># --[BEGIN]------------------------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CODE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;tx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">IP</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;1.1.1.1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;pass&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">COUNTRY</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;CN&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">STATE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;BEIJING&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CITY</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;BEIJING&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ORGANIZATION</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Org&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ORGANIZATIONAL_UNIT</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Dev&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">COMMON_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$IP</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">EMAIL</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># --[END]--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generate CA key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl genrsa -aes256 -passout </span><span class="token string" style="color:#e3116c">&quot;pass:</span><span class="token string variable" style="color:#36acaa">$PASSWORD</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -out </span><span class="token string" style="color:#e3116c">&quot;ca-key-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generate CA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl req -new -x509 -days </span><span class="token number" style="color:#36acaa">365</span><span class="token plain"> -key </span><span class="token string" style="color:#e3116c">&quot;ca-key-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> -sha256 -out </span><span class="token string" style="color:#e3116c">&quot;ca-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> -passin </span><span class="token string" style="color:#e3116c">&quot;pass:</span><span class="token string variable" style="color:#36acaa">$PASSWORD</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -subj </span><span class="token string" style="color:#e3116c">&quot;/C=</span><span class="token string variable" style="color:#36acaa">$COUNTRY</span><span class="token string" style="color:#e3116c">/ST=</span><span class="token string variable" style="color:#36acaa">$STATE</span><span class="token string" style="color:#e3116c">/L=</span><span class="token string variable" style="color:#36acaa">$CITY</span><span class="token string" style="color:#e3116c">/O=</span><span class="token string variable" style="color:#36acaa">$ORGANIZATION</span><span class="token string" style="color:#e3116c">/OU=</span><span class="token string variable" style="color:#36acaa">$ORGANIZATIONAL_UNIT</span><span class="token string" style="color:#e3116c">/CN=</span><span class="token string variable" style="color:#36acaa">$COMMON_NAME</span><span class="token string" style="color:#e3116c">/emailAddress=</span><span class="token string variable" style="color:#36acaa">$EMAIL</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generate Server key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl genrsa -out </span><span class="token string" style="color:#e3116c">&quot;server-key-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generate Server Certs.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl req -subj </span><span class="token string" style="color:#e3116c">&quot;/CN=</span><span class="token string variable" style="color:#36acaa">$COMMON_NAME</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -sha256 -new -key </span><span class="token string" style="color:#e3116c">&quot;server-key-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> -out server.csr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;subjectAltName = IP:</span><span class="token string variable" style="color:#36acaa">$IP</span><span class="token string" style="color:#e3116c">,IP:127.0.0.1&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> extfile.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;extendedKeyUsage = serverAuth&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> extfile.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl x509 -req -days </span><span class="token number" style="color:#36acaa">365</span><span class="token plain"> -sha256 -in server.csr -passin </span><span class="token string" style="color:#e3116c">&quot;pass:</span><span class="token string variable" style="color:#36acaa">$PASSWORD</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -CA </span><span class="token string" style="color:#e3116c">&quot;ca-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> -CAkey </span><span class="token string" style="color:#e3116c">&quot;ca-key-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> -CAcreateserial -out </span><span class="token string" style="color:#e3116c">&quot;server-cert-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> -extfile extfile.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generate Client Certs.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -f extfile.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl genrsa -out </span><span class="token string" style="color:#e3116c">&quot;key-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl req -subj </span><span class="token string" style="color:#e3116c">&#x27;/CN=client&#x27;</span><span class="token plain"> -new -key </span><span class="token string" style="color:#e3116c">&quot;key-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> -out client.csr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> extendedKeyUsage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> clientAuth </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> extfile.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl x509 -req -days </span><span class="token number" style="color:#36acaa">365</span><span class="token plain"> -sha256 -in client.csr -passin </span><span class="token string" style="color:#e3116c">&quot;pass:</span><span class="token string variable" style="color:#36acaa">$PASSWORD</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -CA </span><span class="token string" style="color:#e3116c">&quot;ca-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> -CAkey </span><span class="token string" style="color:#e3116c">&quot;ca-key-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> -CAcreateserial -out </span><span class="token string" style="color:#e3116c">&quot;cert-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> -extfile extfile.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -vf client.csr server.csr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> -v 0400 </span><span class="token string" style="color:#e3116c">&quot;ca-key-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;key-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;server-key-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> -v 0444 </span><span class="token string" style="color:#e3116c">&quot;ca-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;server-cert-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cert-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 打包客户端证书</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p </span><span class="token string" style="color:#e3116c">&quot;tls-client-certs-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -f </span><span class="token string" style="color:#e3116c">&quot;ca-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cert-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;key-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tls-client-certs-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tls-client-certs-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> zcf </span><span class="token string" style="color:#e3116c">&quot;tls-client-certs-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.tar.gz&quot;</span><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tls-client-certs-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.tar.gz&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf </span><span class="token string" style="color:#e3116c">&quot;tls-client-certs-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 拷贝服务端证书</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p /etc/docker/certs.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ca-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;server-cert-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;server-key-</span><span class="token string variable" style="color:#36acaa">$CODE</span><span class="token string" style="color:#e3116c">.pem&quot;</span><span class="token plain"> /etc/docker/certs.d/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用<code>sh auto-tls-certs.sh</code>命令来生成证书，并且生成好的证书会被自动打包为<code>.tar.gz</code>归档，非常方便。下面的图片展示了执行脚本后生成的文件列表。</p><p><img loading="lazy" alt="image-20210816222131111-16291236956091" src="/assets/images/image-20210816222131111-16291236956091-ba65ff370246e82306b56935a27bed2c.png" width="459" height="280" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置-docker">配置 Docker<a class="hash-link" href="#配置-docker" title="标题的直接链接">​</a></h2><p>只需关注<code>.pem</code>文件，把证书找个专门的位置存放。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /etc/.docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> ~/docker-cert/*.pem /etc/.docker/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改 Docker 启动文件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">nano</span><span class="token plain"> /lib/systemd/system/docker.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改<code>Service</code>下的<code>ExecStart</code>配置。</p><div class="language-systemd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-systemd codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key attr-name" style="color:#00a4db">ExecStart</span><span class="token punctuation" style="color:#393A34">=</span><span class="token value attr-value" style="color:#e3116c">/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock -D -H tcp://0.0.0.0:2376 --tlsverify --tlscacert=/etc/.docker/ca-tx.pem --tlscert=/etc/.docker/server-cert-tx.pem --tlskey=/etc/.docker/server-key-tx.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="image-20210816222434122-16291238760702" src="/assets/images/image-20210816222434122-16291238760702-44ce2afe0e7f335aa9bb115c4c7cff40.png" width="1111" height="289" class="img_ev3q"></p><p>重启 Docker。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reloadservice </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="开放端口">开放端口<a class="hash-link" href="#开放端口" title="标题的直接链接">​</a></h2><p>在防火墙、安全组中放行 2376 端口。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试">测试<a class="hash-link" href="#测试" title="标题的直接链接">​</a></h2><p>把证书的压缩包<code>tls-client-certs-tx.tar.gz</code>下载到本机，解压得到证书文件。</p><p><img loading="lazy" alt="image-20210816222527037" src="data:image/png;base64,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" width="269" height="98" class="img_ev3q"></p><p>用<code>curl</code>命令测试，如果有 JSON 格式的信息输出则配置成功。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> https://你的 IP/info --cert cert-tx.pem --key key-tx.pem --cacert ca-tx.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="image-20210816222600935-16291239626163" src="/assets/images/image-20210816222600935-16291239626163-553b178f7586fc8a90c65e3eedb03eed.png" width="581" height="356" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="用-portainer-连接">用 Portainer 连接<a class="hash-link" href="#用-portainer-连接" title="标题的直接链接">​</a></h2><p>Portainer 是一款非常好用的 Docker 可视化管理工具，通过暴露 Docker Remote API 可以远程连接并管理 Docker 资源。</p><p>在<code>Endpoints</code>页面中点击<code>Add endpoint</code>，<code>Environment type</code>选择<code>Docker</code>。</p><p>在对应的输入框中填写 IP 地址和端口号，开启 TLS，选择三个对应的证书文件。</p><p><img loading="lazy" alt="image-20210816222733033-16291240547284" src="/assets/images/image-20210816222733033-16291240547284-a48b6576bf253c03858fa23a69261598.png" width="673" height="634" class="img_ev3q"></p><div class="footnotes"><hr><ol><li id="fn-1-b62d91"><a href="https://documentation.portainer.io/" target="_blank" rel="noopener noreferrer">Documentation</a><a href="#fnref-1-b62d91" class="footnote-backref">↩</a></li><li id="fn-2-b62d91"><a href="https://docs.docker.com/engine/security/protect-access/" target="_blank" rel="noopener noreferrer">Protect the Docker daemon socket | Docker Documentation</a><a href="#fnref-2-b62d91" class="footnote-backref">↩</a></li><li id="fn-3-b62d91"><a href="https://www.gaoyaxuan.net/blog/324.html" target="_blank" rel="noopener noreferrer">Docker 开启 TLS 访问，更加安全 - 实用教程 - 高亚轩的 BLOG</a><a href="#fnref-3-b62d91" class="footnote-backref">↩</a></li></ol></div></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/docker">docker</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/bobo2334/bobo2334.github.io/edit/master/blog/enable-docker-remote-api-with-tls-protection.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/enable-docker-remote-api-with-tls-protection-via-container"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">以容器的方式暴露 Docker Remote API 并启用 TLS</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/ssh-certificate-authentication"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">SSH 密钥登录</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#前言" class="table-of-contents__link toc-highlight">前言</a></li><li><a href="#签发证书" class="table-of-contents__link toc-highlight">签发证书</a></li><li><a href="#配置-docker" class="table-of-contents__link toc-highlight">配置 Docker</a></li><li><a href="#开放端口" class="table-of-contents__link toc-highlight">开放端口</a></li><li><a href="#测试" class="table-of-contents__link toc-highlight">测试</a></li><li><a href="#用-portainer-连接" class="table-of-contents__link toc-highlight">用 Portainer 连接</a></li></ul></div></div></div></div></div></div>
<script src="/assets/js/runtime~main.dce60640.js"></script>
<script src="/assets/js/main.3e5db5dd.js"></script>
</body>
</html>